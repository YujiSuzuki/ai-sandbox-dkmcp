# 既存ソリューションとの比較

AI Sandbox + DockMCPと他のAIセキュリティツールとの比較、そしてなぜ組み合わせて使うのが効果的かを説明します。

[← READMEに戻る](../README.ja.md)

---

## 既存ツール

### Claude Code Sandbox

[Claude Code Sandbox](https://code.claude.com/docs/en/sandboxing) はOSレベルのプリミティブ（macOSのSeatbelt、LinuxのBubblewrap）を使って、ファイルシステムへの書き込みとネットワークアクセスを制限します。パーミッション設定で `Read` のdenyルールを追加し、特定ファイルへのAIの読み取りをブロックすることもできます。

**強み：**
- OSレベルの実行制限（追加セットアップ不要）
- Readのdenyルールで特定ファイルへのアクセスをブロック
- パーミッション確認の手間を軽減

**本プロジェクトが埋めるギャップ：**
- denyルールはアプリケーションレベル — 正しい設定とAIツールがそれを尊重することに依存
- denyルールは[親ディレクトリを走査しない](https://github.com/anthropics/claude-code/issues/12962)ため、モノレポやマルチプロジェクトワークスペースで、あるプロジェクトの設定が兄弟プロジェクトのシークレットを保護しない
- Sandboxはアウトバウンドネットワークを制限するため、コンテナ間デバッグが困難

### Docker AI Sandboxes

[Docker AI Sandboxes](https://docs.docker.com/ai/sandboxes) はAIエージェントを独自のDockerデーモンを持つ隔離されたmicroVMで実行します。エージェントはホストシステムに触れることができません。

**強み：**
- microVMによる強力な分離
- Sandbox内でのAIエージェントの完全な自律性
- 各Sandboxが独自のDockerデーモンを持つ

**本プロジェクトが埋めるギャップ：**
- ワークスペースディレクトリ全体をmicroVMに同期し、特定ファイルを除外する仕組みがない — `.env`ファイルは内部で見える
- 完全に隔離されており、各Sandboxは他のコンテナと通信できないため、コンテナ間デバッグが不可能

### Docker MCP Toolkit

[Docker MCP Toolkit](https://www.docker.com/blog/mcp-toolkit-mcp-servers-that-just-work/) は200以上のコンテナ化されたMCPサーバーを、組み込みの分離とシークレット管理付きで提供します。

**強み：**
- 豊富なビルド済みMCPサーバーカタログ
- MCPサーバー設定のための組み込みシークレット管理

**本プロジェクトが埋めるギャップ：**
- MCPサーバーの分離に焦点を当てており、プロジェクトレベルのシークレットをAIから隠すことは対象外
- ソースツリー内の`.env`ファイルや秘密鍵の問題には対応していない

---

## 本プロジェクトが追加するもの

AI Sandbox + DockMCPは、上記のツールが完全にはカバーしない2つのギャップを埋めます：

### ギャップ1: ファイルシステムレベルのシークレット隠蔽

ルールでシークレットへのアクセスをブロックする（設定ミスやバイパスの可能性がある）代わりに、Dockerボリュームマウントを使ってシークレットをAIのファイルシステムから**物理的に除去**します：

```yaml
volumes:
  - /dev/null:/workspace/my-app/.env:ro     # AIには空ファイルに見える
tmpfs:
  - /workspace/my-app/secrets:ro            # AIには空ディレクトリに見える
```

シークレットはAIの世界に存在しません — ルールでブロックされているのでも、設定でフィルターされているのでもなく、そもそも存在しない。一方、アプリコンテナは実ファイルを通常通りマウントします。

設定ミスに対しては、Sandbox起動時に**バリデーション**を実行し、AIツールのdenyルールと`docker-compose.yml`のボリュームマウントが同期しているかを確認します。片方にしか設定されていないシークレットファイルがあれば、AIがアクセスする前に警告が表示されます。

### ギャップ2: 制御されたコンテナ間アクセス

DockMCPはAI SandboxとDockerコンテナの間のゲートウェイとして機能し、セキュリティポリシーを適用します：

- AIはログの読み取り、ホワイトリストに登録されたコマンドの実行、コンテナの検査が可能
- AIはコンテナの起動/停止、ブロックされたパスへのアクセス、任意のコマンドの実行はできない
- 機密データ（パスワード、APIキー、トークン）は出力時に自動的にマスクされる

---

## 組み合わせて使う

これらのツールは**競合ではなく補完関係**にあります。多層防御として：

| レイヤー | ツール | 役割 |
|---------|--------|------|
| 実行制限 | Claude Code Sandbox | 悪意あるコマンド実行を防止 |
| システム分離 | Docker AI Sandboxes | microVMでAIを隔離 |
| シークレット隠蔽 | **AI Sandbox**（本プロジェクト） | シークレットをAIのファイルシステムから除去 |
| コンテナ間アクセス | **DockMCP**（本プロジェクト） | 他コンテナへの制御されたアクセス |

AI Sandbox *内部で* Claude Code Sandboxを使用することで、最大限の保護が得られます。

---

## まとめ

| 機能 | Claude Code Sandbox | Docker AI Sandboxes | 本プロジェクト |
|------|-------------------|-------------------|--------------|
| 実行制限 | OSレベル | microVM分離 | コンテナ分離 |
| ファイル読み取りブロック | denyルール（アプリケーションレベル） | 仕組みなし | ボリュームマウント（ファイルシステムレベル） |
| マルチプロジェクトスコープ | 制限あり（親ディレクトリ走査なし） | 単一ワークスペース | ワークスペース全体＋ファイル単位の隠蔽 |
| コンテナ間アクセス | 制限あり | 隔離 | DockMCPで制御 |
| 出力のシークレットマスク | なし | なし | 自動 |
| 起動時バリデーション | なし | なし | 自動同期チェック |
| セットアップの複雑さ | なし（組み込み） | Docker Desktop | Docker + docker-compose |
